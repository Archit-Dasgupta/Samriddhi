<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Samriddhi</title>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    /* --- Only flex-based tweaks for nav + small helpers --- */
    .dropdown { position: relative; }
    .dropdown-toggle { cursor:pointer; display:inline-flex; align-items:center; gap:6px; }
    .dropdown-menu {
      position:absolute; top:36px; right:0; background:#fff; border:1px solid var(--border);
      border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.08); min-width:220px; padding:6px; display:none; z-index:50;
    }
    .dropdown.open .dropdown-menu { display:block; }
    .dropdown-item { display:flex; gap:8px; align-items:center; padding:10px 12px; border-radius:10px; text-decoration:none; color:var(--text); }
    .dropdown-item:hover { background:#f9fafb; }
    .badge { font-size:11px; padding:2px 6px; border:1px solid var(--border); border-radius:8px; margin-left:6px; background:#f1f5f9; }
    .pill { display:inline-block; background:#ecfdf5; color:#065f46; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid #a7f3d0; }
    .grid3 { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
    .quiz-card h3 { margin-top:0; }
    .quiz-q { border:1px solid var(--border); padding:10px; border-radius:12px; }
    .quiz-actions { display:flex; gap:8px; align-items:center; }
    .ok { color:#166534; font-weight:700; }
    .err { color:#b91c1c; font-weight:700; }
    .nav-right a, .nav-right button { white-space:nowrap; line-height:1; }

    .item-details { display:none; margin:10px 0 0 40px; }
    .item-details.open { display:block; }
    .yt { width:100%; aspect-ratio:16/9; border:0; border-radius:12px; }
    .play-btn { min-width:28px; }

    /* Nav wrap fix for smaller widths using flex only */
    @media (max-width: 980px){
      .topbar-inner{display:flex; flex-wrap:wrap; row-gap:8px;}
      .brand-left{display:flex; align-items:center; gap:10px; flex:0 1 auto;}
      .nav-right{display:flex; flex-wrap:wrap; gap:14px; justify-content:flex-end; flex:1 1 100%;}
    }
    @media (max-width: 680px){
      .grid3{grid-template-columns:1fr}
      .dropdown-menu{right:auto; left:0;}
      .brand-strong{font-size:20px}
    }

    /* Home info cards */
    .info { display:flex; gap:16px; flex-wrap:wrap; margin-top:16px; }
    .info .card { flex:1 1 280px; }
    .bullets { display:flex; flex-direction:column; gap:8px; margin:0; padding-left:18px; }
  </style>
</head>
<body>
  <!-- NAV -->
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand-left" onclick="location.hash='#/home'">
        <div class="logo-square"><span>‚ó¥</span></div>
        <div class="brand-text"><span class="brand-strong">Samriddhi</span></div>
      </div>
      <nav class="nav-right">
        <div class="dropdown" id="programsDropdown">
          <span class="nav-link dropdown-toggle">Programs ‚ñæ</span>
          <div class="dropdown-menu" aria-label="Programs menu">
            <a class="dropdown-item" href="#/modules">üìö All programs</a>
          </div>
        </div>
        <a class="nav-link" href="#/banking">Banking <span class="chip-new">NEW</span></a>
        <a class="nav-link" href="#/dashboard">Toolkit</a>
        <button id="btnOpenLogin" class="btn login-pill">Login/Register</button>
        <a id="navProfile" class="nav-link hidden" href="#/profile">Profile</a>
      </nav>
    </div>
  </header>

  <!-- HOME -->
  <main class="container" id="page-home">
    <section class="hero card">
      <div class="hero-text">
        <h1>Grow your tailoring business with confidence</h1>
        <p class="muted">
          Samriddhi offers practical video lessons, simple calculators and access to partner
          banking products‚Äîdesigned for women entrepreneurs in small towns and villages.
        </p>
        <div class="row gap">
          <button class="btn primary" id="btnStart">Get Started</button>
          <a class="btn ghost" href="#/modules">Browse Programs</a>
        </div>
      </div>
      <div class="hero-art"></div>
    </section>

    <!-- New: What we do / How we help -->
    <section class="info">
      <article class="card">
        <h3>What we do</h3>
        <p class="muted">We make business skills simple and practical for home‚Äëbased and small‚Äëshop tailors.</p>
        <ul class="bullets">
          <li>Short, phone‚Äëfriendly video lessons</li>
          <li>Tools to price work and track cash</li>
          <li>Guidance to access bank products safely</li>
        </ul>
      </article>
      <article class="card">
        <h3>How Samriddhi helps</h3>
        <ul class="bullets">
          <li>‚úîÔ∏è Learn the right way to price blouses and alterations</li>
          <li>‚úîÔ∏è Keep a daily cashbook and avoid missed expenses</li>
          <li>‚úîÔ∏è Use calculators to plan FDs and micro‚Äëloans you can afford</li>
          <li>‚úîÔ∏è Build steady income with repeat customers</li>
        </ul>
      </article>
      <article class="card">
        <h3>Get started in minutes</h3>
        <p class="muted">No email needed. Log in with your phone number, finish your profile, and start your recommended course.</p>
        <div><a class="btn primary" href="#/login">Login with phone</a></div>
      </article>
    </section>
  </main>

  <!-- LOGIN: STEP 1 (phone) -->
  <main class="container hidden" id="page-login">
    <section class="login card">
      <h2>Login or Register</h2>
      <p class="muted">Enter your mobile number to continue</p>
      <div class="phone-input">
        <div class="phone-cc">+91</div>
        <input id="phoneNumber" inputmode="numeric" pattern="[0-9]*" maxlength="10" placeholder="0000000000"/>
      </div>
      <button id="btnProceedPhone" class="btn primary wide">Continue</button>
      <p class="tiny muted">Demo: any 10-digit number works.</p>
      <div id="login_msg" class="tiny muted"></div>
    </section>
  </main>

  <!-- LOGIN: STEP 2 EXISTING (password) -->
  <main class="container hidden" id="page-password">
    <section class="card">
      <h2>Enter password</h2>
      <p class="muted">We found your account. Enter password to continue.</p>
      <input id="login_pass" type="password" placeholder="Password"/>
      <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
        <button id="btnLogin" class="btn primary">Login</button>
        <a href="#/login" class="btn ghost">Back</a>
        <span id="pass_msg" class="tiny muted"></span>
      </div>
    </section>
  </main>

  <!-- ACCOUNT CREATION (set password) -->
  <main class="container hidden" id="page-create">
    <section class="card">
      <h2>Create your account</h2>
      <p class="muted">Finish setting up your profile and choose a password.</p>
      <div class="grid3" style="gap:8px">
        <label>Phone (read-only)<input id="create_phone" disabled/></label>
        <label>Name<input id="create_name" placeholder="Your name"/></label>
        <label>Village / City<input id="create_city" placeholder="Your town"/></label>
      </div>
      <div class="grid2" style="gap:8px;margin-top:8px">
        <label>Password<input id="create_pw" type="password" placeholder="At least 4 characters"/></label>
        <label>Confirm password<input id="create_cpw" type="password"/></label>
      </div>
      <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
        <button id="btnCreate" class="btn primary">Create account</button>
        <a href="#/login" class="btn ghost">Back</a>
        <span id="create_msg" class="muted tiny"></span>
      </div>
    </section>
  </main>

  <!-- PROGRAMS / MODULES -->
  <main class="container hidden" id="page-modules">
    <section class="modules-grid">
      <aside class="left-rail card">
        <div class="rail-header">
          <span class="crumb">Home</span> / <span class="crumb strong">Programs</span>
        </div>
        <ol class="steps">
          <li class="done">Pick a track</li>
          <li class="done">Set your goals</li>
          <li class="active">Review content</li>
        </ol>
        <button class="btn ghost small" id="btnExitGuide">Go to Dashboard</button>
      </aside>
      <section class="recos card">
        <div class="recos-head">
          <h2>Recommended course content</h2>
          <div class="save-indicator">Saved ‚Ä¢ Total length: <span id="totalLen">0m</span></div>
        </div>
        <div id="moduleList" class="module-sections"></div>
      </section>
    </section>
  </main>

  <!-- BANKING -->
  <main class="container hidden" id="page-banking">
    <section class="bank-wrap">
      <div class="bank-hero card">
        <img class="bank-img" alt="Bank" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjYwMCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImciIHgxPSIwIiB4Mj0iMSIgeTE9IjAiIHkyPSIxIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzE2YTM0YSIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMyMmM1NWUiLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgPC9kZWZzPgogIDxyZWN0IHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0idXJsKCNnKSIvPgogIDxnIGZvbnQtZmFtaWx5PSJBcmlhbCwgSGVsdmV0aWNhLCBzYW5zLXNlcmlmIiBmaWxsPSIjZmZmZmZmIiBmb250LXNpemU9IjY0Ij4KICAgIDx0ZXh0IHg9IjYwIiB5PSIxMTAiPlNBTVJJRERISSBCQU5LSU5HPC90ZXh0PgogIDwvZz4KICA8ZyBmaWxsPSIjZmZmZmZmIj4KICAgIDxyZWN0IHg9IjcwIiB5PSIxNjAiIHdpZHRoPSI0MjAiIGhlaWdodD0iMzAwIiByeD0iMTYiIG9wYWNpdHk9IjAuMTUiLz4KICAgIDxyZWN0IHg9IjUyMCIgeT0iMTYwIiB3aWR0aD0iNDIwIiBoZWlnaHQ9IjMwMCIgcng9IjE2IiBvcGFjaXR5PSIwLjE1Ii8+CiAgICA8cmVjdCB4PSI5NzAiIHk9IjE2MCIgd2lkdGg9IjE2MCIgaGVpZ2h0PSIzMDAiIHJ4PSIxNiIgb3BhY2l0eT0iMC4xNSIvPgogIDwvZz4KPC9zdmc+"/>
        <aside class="calc card">
          <h3 class="calc-title">Fixed Deposit Calculator</h3>
          <div class="grid2">
            <label>Amount (‚Çπ)<input id="invAmount" type="number" value="100000"/></label>
            <label>Sr. Citizen
              <select id="srCitizen"><option>No</option><option>Yes</option></select>
            </label>
          </div>
          <label>Interest rate and tenure
            <select id="tenurePick">
              <option value="60|8.2">5Y (8.2%)</option>
              <option value="36|7.6">3Y (7.6%)</option>
              <option value="12|7.0">1Y (7.0%)</option>
            </select>
          </label>
          <div class="facts">
            <div class="fact"><span>Investment amount</span><strong id="fInv">‚Çπ1,00,000</strong></div>
            <div class="fact"><span>Compounding</span><strong>Quarterly</strong></div>
            <div class="fact"><span>FD rate applicable</span><strong id="fRate">8.2%</strong></div>
            <div class="fact"><span>FD tenure</span><strong id="fTenure">5Y</strong></div>
            <div class="fact"><span>Maturity amount</span><strong id="fMaturity">‚Çπ‚Äî</strong></div>
          </div>
          <div class="grid2" style="margin-top:8px">
            <a class="btn ghost" href="#/open-account">Open an account</a>
            <a class="btn primary" href="#/loan">Apply for a loan</a>
          </div>
        </aside>
      </div>
    </section>
  </main>

  <!-- OPEN ACCOUNT (demo) -->
  <main class="container hidden" id="page-open-account">
    <section class="card">
      <h2>Open an Account (Demo)</h2>
      <div class="grid3" style="gap:8px">
        <label>Full name<input id="acc_name" placeholder="e.g., Sita Devi"/></label>
        <label>Village / City<input id="acc_city" placeholder="e.g., Murbad"/></label>
        <label>PAN (optional)<input id="acc_pan" placeholder="ABCDE1234F"/></label>
      </div>
      <div class="grid2" style="gap:8px; margin-top:8px">
        <label>Initial deposit (‚Çπ)<input id="acc_amt" type="number" value="5000"/></label>
        <label>Account type
          <select id="acc_type"><option>Basic Savings</option><option>Regular Savings</option></select>
        </label>
      </div>
      <div style="margin-top:12px; display:flex; gap:8px">
        <button id="acc_submit" class="btn primary">Submit</button>
        <a class="btn ghost" href="#/banking">Back to Banking</a>
        <span id="acc_msg" class="muted"></span>
      </div>
    </section>
  </main>

  <!-- LOAN (demo) -->
  <main class="container hidden" id="page-loan">
    <section class="card">
      <h2>Apply for a Micro-Loan (Demo)</h2>
      <div class="grid3" style="gap:8px">
        <label>Loan amount (‚Çπ)<input id="loan_amt" type="number" value="25000"/></label>
        <label>Purpose
          <select id="loan_purpose">
            <option>Sewing Machine</option>
            <option>Shop Renovation</option>
            <option>Working Capital</option>
          </select>
        </label>
        <label>Tenure (months)
          <select id="loan_tenure">
            <option>12</option><option>18</option><option>24</option>
          </select>
        </label>
      </div>
      <div class="grid2" style="gap:8px; margin-top:8px">
        <label>Monthly income (‚Çπ)<input id="loan_income" type="number" value="15000"/></label>
        <label>Existing EMIs (‚Çπ)<input id="loan_emi" type="number" value="0"/></label>
      </div>
      <div style="margin-top:12px; display:flex; gap:8px">
        <button id="loan_submit" class="btn primary">Check Eligibility</button>
        <a class="btn ghost" href="#/banking">Back to Banking</a>
        <span id="loan_msg" class="muted"></span>
      </div>
    </section>
  </main>

  <!-- DASHBOARD -->
  <main class="container hidden" id="page-dashboard">
    <section class="card">
      <h2>Welcome to your dashboard</h2>
      <p class="muted">You're logged in (demo session). Explore <a href="#/modules">programs</a> or go to <a href="#/banking">banking</a>.</p>
    </section>
  </main>

  <!-- PROFILE -->
  <main class="container hidden" id="page-profile">
    <section class="card">
      <h2>Your Profile</h2>
      <p class="muted">Manage your details. Stored in your browser for demo purposes.</p>
      <div class="grid3" style="gap:8px">
        <label>Phone (read-only)<input id="prof_phone" disabled/></label>
        <label>Name<input id="prof_name" placeholder="Your name"/></label>
        <label>Village / City<input id="prof_city" placeholder="Your town"/></label>
      </div>
      <div class="grid2" style="gap:8px; margin-top:8px">
        <label>Occupation<input id="prof_job" placeholder="e.g., Tailor"/></label>
        <label>Language
          <select id="prof_lang"><option>English</option><option>Hindi</option><option>Marathi</option><option>Bengali</option></select>
        </label>
      </div>
      <div style="margin-top:12px; display:flex; gap:8px; align-items:center">
        <button id="prof_save" class="btn primary">Save</button>
        <button id="prof_logout" class="btn ghost">Log out</button>
        <span id="prof_msg" class="muted"></span>
      </div>
    </section>
  </main>

  <footer class="tiny muted center">¬© Samriddhi</footer>

  <script>
    // ====== Helpers & Storage ======
    const $ = (s)=>document.querySelector(s);
    const $$ = (s)=>document.querySelectorAll(s);

    const PAGES = ['home','login','password','create','modules','banking','open-account','loan','dashboard','profile'];
    function show(page){
      PAGES.forEach(p=>$('#page-'+p)?.classList.add('hidden'));
      $('#page-'+page)?.classList.remove('hidden');
      const newHash = '#/'+page;
      if(location.hash !== newHash) window.location.hash = newHash;
    }
    window.addEventListener('hashchange', ()=>{
      const raw = location.hash.replace('#/','') || 'home';
      show(PAGES.includes(raw) ? raw : 'home');
    });

    const ACC_KEY = 'sam_accounts';
    const SESS_KEY = 'sam_session';
    function getAccounts(){ return JSON.parse(localStorage.getItem(ACC_KEY) || '{}'); }
    function setAccounts(obj){ localStorage.setItem(ACC_KEY, JSON.stringify(obj)); }
    function setSession(obj){ localStorage.setItem(SESS_KEY, JSON.stringify(obj)); }
    function getSession(){ return JSON.parse(localStorage.getItem(SESS_KEY) || 'null'); }
    function clearSession(){ localStorage.removeItem(SESS_KEY); }

    // very light demo hash (NOT secure, just to avoid storing plain text)
    const DEMO_SALT = 'samriddhi';
    const hash = (s)=> btoa(unescape(encodeURIComponent(DEMO_SALT + '|' + s)));

    // ====== Modules (with interleaved quizzes) ======
    const YT_EMBED = 'https://www.youtube-nocookie.com/embed/dQw4w9WgXcQ?rel=0&modestbranding=1&playsinline=1';

    const quizBanks = {
      q1: [
        { q:'Best way to record daily cash?', opts:['Memory','Cashbook','Bank passbook'], ans:1 },
        { q:'What goes into blouse price?', opts:['Thread only','Fabric only','All materials & time'], ans:2 },
        { q:'Service the machine?', opts:['Never','When broken','Regularly as per manual'], ans:2 }
      ],
      q2: [
        { q:'Why keep a cashbook?', opts:['Decoration','Track income & expense','Only to show bank'], ans:1 },
        { q:'Working capital example?', opts:['Daily cash for orders','Buying a shop','Buying land'], ans:0 },
        { q:'If income ‚Çπ15k, safe EMI share ~', opts:['10%','35%','80%'], ans:1 }
      ]
    };

    const modules = [
      {title: 'Introduction to Tailoring', minutes: 65, items: [
        { type:'video', title:'Welcome & safety', mins:6 },
        { type:'video', title:'Understanding your machine', mins:12 },
        { type:'quiz',  title:'Checkpoint Quiz 1', mins:5, quizId:'q1' },
        { type:'video', title:'Threads & needles', mins:10 },
        { type:'reading', title:'Finding fabric locally', mins:6 },
        { type:'video', title:'Your first stitch', mins:10 },
        { type:'video', title:'Care & maintenance', mins:16 }
      ]},
      {title: 'Business Basics', minutes: 35, items: [
        { type:'video', title:'Pricing a blouse', mins:12 },
        { type:'quiz',  title:'Checkpoint Quiz 2', mins:5, quizId:'q2' },
        { type:'video', title:'Managing orders', mins:8 },
        { type:'reading', title:'Keeping a cashbook', mins:10 }
      ]}
    ];

    function closeAllDetails(){
      $$('.item-details.open').forEach(d=>{
        d.classList.remove('open');
        const ifr = d.querySelector('iframe');
        if(ifr){ ifr.src='about:blank'; ifr.remove(); }
      });
    }

    function renderModules(){
      const host = $('#moduleList'); host.innerHTML='';
      let total=0;
      modules.forEach((mod, idx)=>{
        total += mod.minutes;
        const sec = document.createElement('section');
        sec.className = 'module-sec';
        sec.innerHTML = `
          <div class="sec-head">
            <div>
              <button class="collapse-btn" data-i="${idx}" aria-expanded="true" aria-controls="items-${idx}">‚ñæ</button>
              <span class="sec-title">${idx+1}. ${mod.title}</span>
            </div>
            <span class="muted">${mod.minutes}m</span>
          </div>
          <div class="items" id="items-${idx}"></div>
        `;
        host.appendChild(sec);
        const items = sec.querySelector('.items');
        mod.items.forEach((it)=>{
          const row = document.createElement('div');
          row.className = 'item-row';
          row.dataset.type = it.type;
          if(it.quizId) row.dataset.quizid = it.quizId;
          row.innerHTML = `
            <div class="left">
              <button class="play-btn ghost-icon" title="Open">${it.type==='video'?'‚ñ∂':(it.type==='quiz'?'üìù':'üìÑ')}</button>
              <div class="it-title">${it.title}</div>
            </div>
            <div class="right">
              <span class="muted">${it.mins}m</span>
              <button class="ghost-icon" title="Move">‚ò∞</button>
              <button class="ghost-icon" title="Edit">‚úé</button>
            </div>
          `;
          const details = document.createElement('div');
          details.className = 'item-details';
          details.innerHTML = `<div class="holder"></div>`;
          items.appendChild(row);
          items.appendChild(details);

          row.addEventListener('click', (e)=>{
            if(e.target.closest('.ghost-icon') && !e.target.classList.contains('play-btn')) return; // ignore other icons
            toggleItem(row);
          });
        });
      });
      $('#totalLen').textContent = total + 'm';
      $$('.collapse-btn').forEach(btn=>{
        btn.onclick = (e)=>{
          const i = e.currentTarget.getAttribute('data-i');
          const box = document.querySelector('#items-'+i);
          const isHidden = box.classList.toggle('hidden');
          e.currentTarget.textContent = isHidden ? '‚ñ∏' : '‚ñæ';
          e.currentTarget.setAttribute('aria-expanded', String(!isHidden));
          if(isHidden) closeAllDetails();
        };
      });
    }

    function toggleItem(row){
      const details = row.nextElementSibling;
      const open = details.classList.contains('open');
      if(open){
        details.classList.remove('open');
        const ifr = details.querySelector('iframe');
        if(ifr){ ifr.src='about:blank'; ifr.remove(); }
        return;
      }
      closeAllDetails();
      details.classList.add('open');
      const holder = details.querySelector('.holder'); holder.innerHTML='';
      const kind = row.dataset.type;
      if(kind==='video'){
        const iframe = document.createElement('iframe');
        iframe.className = 'yt';
        iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
        iframe.allowFullscreen = true;
        iframe.src = YT_EMBED;
        holder.appendChild(iframe);
        const link = document.createElement('div');
        link.className='tiny muted'; link.innerHTML='<a target="_blank" href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">Open on YouTube</a>';
        holder.appendChild(link);
      } else if(kind==='quiz'){
        const id = row.dataset.quizid;
        const qs = quizBanks[id] || [];
        const form = document.createElement('div');
        form.innerHTML = qs.map((it, i)=>`
          <div class='quiz-q' style='margin:8px 0'>
            <div style='font-weight:700;margin-bottom:6px'>${i+1}. ${it.q}</div>
            ${it.opts.map((o,j)=>`<label style="display:flex;gap:8px;align-items:center;margin:4px 0"><input type="radio" name="${id}_q${i}" value="${j}"/> <span>${o}</span></label>`).join('')}
          </div>
        `).join('');
        const actions = document.createElement('div');
        actions.className='quiz-actions'; actions.style.marginTop='8px';
        const submit=document.createElement('button'); submit.className='btn primary'; submit.textContent='Submit quiz';
        const reset=document.createElement('button'); reset.className='btn ghost'; reset.textContent='Reset';
        const result=document.createElement('span'); result.className='muted'; result.style.marginLeft='8px';
        actions.appendChild(submit); actions.appendChild(reset); actions.appendChild(result);
        holder.appendChild(form); holder.appendChild(actions);
        submit.onclick=()=>{
          let score=0; qs.forEach((qq,i)=>{ const sel = holder.querySelector(`input[name='${id}_q${i}']:checked`); if(sel && Number(sel.value)===qq.ans) score++; });
          result.innerHTML = (score===qs.length) ? `<span class='ok'>Perfect! ${score}/${qs.length}</span>` : `<span class='err'>Score: ${score}/${qs.length}</span>`;
          localStorage.setItem('sam_quiz_'+id, String(score));
        };
        reset.onclick=()=>{ holder.querySelectorAll(`input[name^='${id}_q']`).forEach(r=>r.checked=false); result.textContent=''; localStorage.removeItem('sam_quiz_'+id); };
      } else {
        holder.innerHTML = '<div class="muted">Reading: short tips and checklists (placeholder).</div>';
      }
      details.scrollIntoView({behavior:'smooth', block:'center'});
    }

    // ====== Banking calc ======
    function calcMaturity(principal, ratePct, months){
      const qRate = ratePct/100/4;
      const years = months/12;
      const A = principal * Math.pow(1 + qRate, 4*years);
      return Math.round(A);
    }
    function updateFacts(){
      const parts = $('#tenurePick').value.split('|').map(Number);
      const months = parts[0]; const rate = parts[1];
      const amt = Number($('#invAmount').value||0);
      $('#fInv').textContent = '‚Çπ' + amt.toLocaleString('en-IN');
      $('#fRate').textContent = rate + '%';
      $('#fTenure').textContent = (months/12) + 'Y';
      const mat = calcMaturity(amt, rate, months);
      $('#fMaturity').textContent = '‚Çπ' + mat.toLocaleString('en-IN');
    }

    // ====== Auth Flow ======
    $('#btnStart').onclick = ()=> show('login');
    $('#btnOpenLogin').onclick = ()=> show('login');

    // Step 1: enter phone
    $('#btnProceedPhone').onclick = ()=>{
      const ph = ($('#phoneNumber').value || '').replace(/\D/g,'');
      if(ph.length !== 10){ $('#login_msg').textContent = 'Enter a valid 10-digit number.'; return; }
      localStorage.setItem('sam_tmp_phone', ph);
      const accounts = getAccounts();
      if(accounts[ph]){
        show('password');
      }else{
        $('#create_phone').value = ph;
        show('create');
      }
    };

    // Existing user: password step
    $('#btnLogin').onclick = ()=>{
      const ph = localStorage.getItem('sam_tmp_phone') || '';
      const pw = $('#login_pass').value;
      const accs = getAccounts();
      if(!accs[ph]){ $('#pass_msg').textContent='Account not found.'; return; }
      if(accs[ph].pw !== hash(pw)){ $('#pass_msg').textContent='Wrong password.'; return; }
      const sess = { phone: ph, name: accs[ph].name || '', city: accs[ph].city || '' };
      setSession(sess);
      $('#btnOpenLogin').classList.add('hidden'); $('#navProfile').classList.remove('hidden');
      show('modules');
    };

    // New user: create account
    $('#btnCreate').onclick = ()=>{
      const ph = localStorage.getItem('sam_tmp_phone') || '';
      const name = $('#create_name').value.trim();
      const city = $('#create_city').value.trim();
      const pw = $('#create_pw').value;
      const cpw = $('#create_cpw').value;
      if(pw.length < 4){ $('#create_msg').textContent='Password too short.'; return; }
      if(pw !== cpw){ $('#create_msg').textContent='Passwords do not match.'; return; }
      const accs = getAccounts();
      accs[ph] = { name, city, pw: hash(pw) };
      setAccounts(accs);
      const sess = { phone: ph, name, city };
      setSession(sess);
      $('#btnOpenLogin').classList.add('hidden'); $('#navProfile').classList.remove('hidden');
      show('modules');
    };

    // Profile & logout
    function loadProfileUI(){
      const sess = getSession() || {};
      $('#prof_phone').value = sess.phone || '';
      $('#prof_name').value = sess.name || '';
      $('#prof_city').value = sess.city || '';
      $('#prof_job').value = sess.job || '';
      $('#prof_lang').value = sess.lang || 'English';
    }
    $('#prof_save').onclick = ()=>{
      const sess = getSession() || {};
      const accs = getAccounts();
      const ph = sess.phone;
      const updated = {
        ...accs[ph],
        name: $('#prof_name').value.trim(),
        city: $('#prof_city').value.trim(),
        job: $('#prof_job').value.trim(),
        lang: $('#prof_lang').value
      };
      accs[ph] = updated; setAccounts(accs);
      setSession({ ...sess, ...updated });
      $('#prof_msg').innerHTML = '<span class="ok">Saved.</span>';
    };
    $('#prof_logout').onclick = ()=>{
      clearSession();
      $('#navProfile').classList.add('hidden');
      $('#btnOpenLogin').classList.remove('hidden');
      show('home');
    };

    // Banking links
    $('#acc_submit').onclick = ()=>{ $('#acc_msg').innerHTML='<span class="ok">Account request submitted. Ref: ACC'+Math.floor(Math.random()*99999)+'</span>'; setTimeout(()=>show('dashboard'), 900); };
    $('#loan_submit').onclick = ()=>{
      const A=Number($('#loan_amt').value||0);
      const I=Number($('#loan_income').value||0);
      const E=Number($('#loan_emi').value||0);
      if(A<1000 || I<=0 || E<0){ $('#loan_msg').textContent='Check numbers and try again.'; return; }
      const r = 0.20/12, n = Number($('#loan_tenure').value);
      const emi = A * r * Math.pow(1+r, n) / (Math.pow(1+r, n)-1);
      const ok = (emi + E) <= 0.35 * I;
      $('#loan_msg').innerHTML = ok
        ? '<span class="ok">Eligible. Est. EMI ‚Çπ'+Math.round(emi).toLocaleString('en-IN')+'</span>'
        : '<span class="err">Not eligible at current income/EMIs.</span>';
      if(ok) setTimeout(()=>show('dashboard'), 1200);
    };

    // Misc
    $('#btnExitGuide').onclick = ()=> show('dashboard');
    $('#tenurePick').onchange = updateFacts; $('#invAmount').oninput = updateFacts; updateFacts();

    // Dropdown
    const dd = $('#programsDropdown');
    dd.querySelector('.dropdown-toggle').addEventListener('click', ()=> dd.classList.toggle('open'));
    document.addEventListener('click', (e)=>{ if(!dd.contains(e.target)) dd.classList.remove('open'); });

    // Init
    function init(){
      const sess = getSession();
      if(sess){ $('#navProfile').classList.remove('hidden'); $('#btnOpenLogin').classList.add('hidden'); }
      renderModules();
      const raw = location.hash.replace('#/','') || 'home';
      show(PAGES.includes(raw) ? raw : 'home');
    }
    init();

    // Observe route changes to load profile UI
    const ro = new MutationObserver(()=>{ if(!$('#page-profile').classList.contains('hidden')) loadProfileUI(); });
    ro.observe(document.body, {subtree:true, attributes:true, attributeFilter:['class']});
  </script>
</body>
</html>
